<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora de Descuentos</title>
<style>
  :root { --bg:#fff; --fg:#000; }
  * { box-sizing: border-box; }
  body {
    margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background: var(--bg); color: var(--fg);
    display:flex; min-height:100vh; align-items:center; justify-content:center; padding:20px;
  }
  .wrap { width:min(520px, 100%); }
  h1 { text-align:center; margin:0 0 16px; font-size:clamp(1.2rem, 3.5vw, 1.8rem); }
  .card {
    border:2px solid var(--fg); border-radius:14px; padding:18px;
  }
  label { display:block; font-weight:700; margin-top:10px; }
  input, button {
    width:100%; padding:12px; margin-top:6px; border:1px solid var(--fg);
    border-radius:10px; background:var(--bg); color:var(--fg); font-size:1rem;
  }
  input:focus { outline: none; box-shadow: 0 0 0 2px var(--fg) inset; }
  .row { display:flex; gap:10px; flex-wrap:wrap; }
  .row > div { flex:1 1 240px; }
  button {
    border: none; background: var(--fg); color: var(--bg); font-weight: 700; cursor:pointer;
  }
  button:hover { opacity:.9; }
  .ghost { background: transparent; color: var(--fg); border:2px solid var(--fg); }
  .result { margin-top:16px; border-top:1px solid var(--fg); padding-top:14px; font-size:1.05rem; }
  .muted { opacity:.7; font-size:.95rem; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Calculadora de Descuento</h1>
    <div class="card">
      <div class="row">
        <div>
          <label for="precio">Precio original (MXN)</label>
          <!-- inputmode=decimal muestra el teclado numérico con punto en iPhone -->
          <input id="precio" type="text" inputmode="decimal" placeholder="$0.00" autocomplete="off" />
        </div>
        <div>
          <label for="descuento">Descuento (%)</label>
          <input id="descuento" type="number" inputmode="decimal" step="0.01" min="0" max="100" placeholder="Ej. 20" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div><button id="btnCalc">Calcular</button></div>
        <div><button class="ghost" id="btnReset">Hacer otra cuenta</button></div>
      </div>

      <div class="result" id="resultado" aria-live="polite"></div>
      <div class="muted">Tip: escribe el precio y al salir del campo se formatea como pesos mexicanos.</div>
    </div>
  </div>

<script>
  const precioInput = document.getElementById('precio');
  const descuentoInput = document.getElementById('descuento');
  const resultado = document.getElementById('resultado');
  const fmtMXN = new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' });

  // Convierte texto con $ , . a número. Soporta coma o punto como decimal.
  function parseMoney(str) {
    let s = String(str || '').trim();
    s = s.replace(/[^0-9.,-]/g, ''); // deja solo dígitos, coma, punto y signo
    if (!s) return NaN;

    const hasComma = s.includes(',');
    const hasDot = s.includes('.');

    if (hasComma && hasDot) {
      // asume coma como separador de miles -> quita comas
      s = s.replace(/,/g, '');
    } else if (hasComma && !hasDot) {
      // asume coma como decimal -> cambia a punto
      s = s.replace(/,/g, '.');
    }
    // quita puntos extra después del primero
    s = s.replace(/(.*\..*)\./g, '$1');
    return parseFloat(s);
  }

  // Limpia caracteres no válidos mientras escribes (sin formatear a moneda)
  precioInput.addEventListener('input', (e) => {
    const cursor = e.target.selectionStart;
    const before = e.target.value;
    e.target.value = before.replace(/[^0-9.,]/g, '');
    // intenta mantener cursor cercano al final (simple y estable en iOS)
    e.target.setSelectionRange(Math.min(cursor, e.target.value.length), Math.min(cursor, e.target.value.length));
  });

  // Al entrar al campo, quita el formato para que sea editable cómodamente
  precioInput.addEventListener('focus', (e) => {
    const n = parseMoney(e.target.value);
    if (!isNaN(n)) e.target.value = String(n);
  });

  // Al salir del campo, aplica formato MXN
  precioInput.addEventListener('blur', (e) => {
    const n = parseMoney(e.target.value);
    e.target.value = isNaN(n) ? '' : fmtMXN.format(n);
  });

  document.getElementById('btnCalc').addEventListener('click', () => {
    const precio = parseMoney(precioInput.value);
    const descuento = parseFloat(descuentoInput.value);

    if (isNaN(precio) || precio <= 0 || isNaN(descuento) || descuento < 0 || descuento > 100) {
      resultado.innerHTML = 'Por favor ingresa valores válidos.';
      return;
    }

    const ahorro = precio * (descuento / 100);
    const final = Math.max(0, precio - ahorro);

    resultado.innerHTML = `
      Precio original: <strong>${fmtMXN.format(precio)}</strong><br>
      Descuento: <strong>${descuento.toFixed(2)}%</strong><br>
      Precio final: <strong>${fmtMXN.format(final)}</strong><br>
      Te ahorras: <strong>${fmtMXN.format(ahorro)}</strong>
    `;
  });

  document.getElementById('btnReset').addEventListener('click', () => {
    precioInput.value = '';
    descuentoInput.value = '';
    resultado.innerHTML = '';
    precioInput.focus();
  });
</script>
</body>
</html>